#!/usr/bin/env zsh
source ${0:A:h}/../../deploy
NVIM_INSTALL_DIR="$XDG_CONFIG_HOME/nvim"

install() {
    case $(__os) in
      macos) __nan_has nvim || brew install neovim ;;
    esac
    if ! topic-enabled-p dev/python || ! topic-enabled-p dev/node; then
      __nan_err "Python or Node not enabled on system. Please enable both before proceeding."
      exit 1
    else
        local current_py="$(pyenv latest -P)"
        pyenv virtualenv $current_py neovim3 \
            && pyenv activate neovim3 \
            && python -m pip install --upgrade pip \
            && python -m pip install pynvim \
            && pyenv deactivate
    fi
    __nan_ok "Installed plug.vim."
    __ensure_repo nnothstine/nvim $XDG_CONFIG_HOME/nvim
    nvim +PlugInstall +qa
}

link() {
    # __nan_link $NVIM_INSTALL_DIR $XDG_CONFIG_HOME/vim
}

clean() {
    rm -rfv $NVIM_INSTALL_DIR
    rm -rfv $XDG_CONFIG_HOME/vim
}

init "$@"
